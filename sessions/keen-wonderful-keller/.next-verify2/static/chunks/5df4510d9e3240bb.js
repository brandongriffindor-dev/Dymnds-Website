(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,94008,e=>{"use strict";e.i(36180);var t=e.i(98925),s=e.i(53699);e.i(47167);let r=new Set(["email","customer_email","customerEmail","phone","password","token","idToken","creditCard","ssn"]);function a(e,t,s,a){let l={level:e,message:t,timestamp:new Date().toISOString()};return s&&Object.keys(s).length>0&&(l.context=function e(t){let s={...t};for(let[t,a]of Object.entries(s))"string"==typeof a&&r.has(t)?s[t]=a.length>3?a.slice(0,3)+"***":"***":"object"!=typeof a||null===a||Array.isArray(a)||(s[t]=e(a));return s}(s)),a instanceof Error?l.error={name:a.name,message:a.message,stack:a.stack}:a&&(l.error={name:"UnknownError",message:String(a)}),l}function l(e){let t=JSON.stringify(e);"error"===e.level||"warn"===e.level?console.error(t):console.log(t)}let i={debug(e,t){},info(e,t){l(a("info",e,t))},warn(e,t,s){l(a("warn",e,t,s))},error(e,t,s){l(a("error",e,t,s))}};function d(e,r,a){(0,t.addDoc)((0,t.collection)(s.db,"admin_audit_log"),{action:e,details:r,admin_email:a||"unknown",timestamp:(0,t.serverTimestamp)(),created_at:new Date().toISOString()}).catch(t=>{i.error("Audit log write failed",{action:e},t)})}e.s(["logAdminAction",()=>d],94008)},84526,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(36180);var r=e.i(98925),a=e.i(53699),l=e.i(94008);function i(e){let t=new Map;return e.forEach(e=>{let s=e.customer_email;t.has(s)||t.set(s,{email:s,totalSpent:0,orderCount:0,lastOrderDate:e.created_at,notes:""});let r=t.get(s);r.totalSpent+=e.total_amount,r.orderCount+=1,r.lastOrderDate||(r.lastOrderDate=e.created_at)}),Array.from(t.values()).map(e=>{let t=e.lastOrderDate?new Date(e.lastOrderDate):null,s=new Date,r=t?Math.floor((s.getTime()-t.getTime())/864e5):void 0;return{...e,isVIP:e.totalSpent>500,avgOrderValue:e.orderCount>0?e.totalSpent/e.orderCount:0,lastOrderDaysAgo:r}}).sort((e,t)=>t.totalSpent-e.totalSpent)}function d(){let[e,d]=(0,s.useState)([]),[n,o]=(0,s.useState)([]),[c,x]=(0,s.useState)([]),[m,h]=(0,s.useState)(!0),[u,b]=(0,s.useState)(!1),[p,g]=(0,s.useState)(!0),[j,w]=(0,s.useState)(null),[v,N]=(0,s.useState)(""),[f,y]=(0,s.useState)(null),[S,O]=(0,s.useState)(""),[C,A]=(0,s.useState)(!1);(0,s.useEffect)(()=>{h(!0);let e=(0,r.query)((0,r.collection)(a.db,"orders"),(0,r.orderBy)("created_at","desc"),(0,r.limit)(200)),t=(0,r.onSnapshot)(e,e=>{let t=[];e.forEach(e=>{t.push({...e.data(),id:e.id})}),e.docs.length>0&&w(e.docs[e.docs.length-1]),g(e.docs.length>=200),x(t),d(i(t)),h(!1)});return()=>t()},[]);let D=async()=>{if(j&&!u&&p){b(!0);try{let e=(0,r.query)((0,r.collection)(a.db,"orders"),(0,r.orderBy)("created_at","desc"),(0,r.startAfter)(j),(0,r.limit)(200)),t=await (0,r.getDocs)(e),s=[];t.forEach(e=>{s.push({...e.data(),id:e.id})}),t.docs.length>0&&w(t.docs[t.docs.length-1]),g(t.docs.length>=200);let l=[...c,...s];x(l),d(i(l))}catch(e){console.error("Error loading more orders:",e)}finally{b(!1)}}};(0,s.useEffect)(()=>{let t=e;v&&(t=t.filter(e=>e.email.toLowerCase().includes(v.toLowerCase()))),o(t)},[e,v]);let k={totalCustomers:e.length,vipCustomers:e.filter(e=>e.isVIP).length,activeThisMonth:e.filter(e=>e.lastOrderDaysAgo&&e.lastOrderDaysAgo<=30).length,avgOrderValue:e.length>0?(e.reduce((e,t)=>e+t.totalSpent,0)/e.length).toFixed(2):"0"},_=async e=>{try{let t=(await (0,r.getDocs)((0,r.collection)(a.db,"customer_notes"))).docs.find(t=>t.id===e);t?O(t.data().notes||""):O("")}catch(e){console.error("Error fetching notes:",e)}},T=async()=>{if(f){A(!0);try{let e;await (0,r.setDoc)((0,r.doc)(a.db,"customer_notes",f),{notes:S,updated_at:new Date().toISOString()},{merge:!0}),(0,l.logAdminAction)("customer_note_saved",{customerEmail:f},(e=(0,a.getAuthClient)(),e?.currentUser?.email||"unknown")),A(!1)}catch(e){console.error("Error saving notes:",e),A(!1)}}},V=e.find(e=>e.email===f),E=f?c.filter(e=>e.customer_email===f):[];return(0,t.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,t.jsxs)("div",{className:"border-b border-white/[0.08] px-6 py-8",children:[(0,t.jsx)("h1",{className:"font-bebas text-4xl tracking-wider",children:"Customers"}),(0,t.jsx)("p",{className:"text-white/60 mt-2",children:"Manage and analyze customer relationships"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 px-6 py-6",children:[(0,t.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,t.jsx)("div",{className:"text-white/60 text-sm",children:"Total Customers"}),(0,t.jsx)("div",{className:"font-bebas text-3xl mt-2",children:k.totalCustomers})]}),(0,t.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,t.jsx)("div",{className:"text-purple-300 text-sm",children:"VIP Customers"}),(0,t.jsx)("div",{className:"font-bebas text-3xl mt-2",children:k.vipCustomers})]}),(0,t.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,t.jsx)("div",{className:"text-emerald-300 text-sm",children:"Active This Month"}),(0,t.jsx)("div",{className:"font-bebas text-3xl mt-2",children:k.activeThisMonth})]}),(0,t.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,t.jsx)("div",{className:"text-blue-300 text-sm",children:"Avg Order Value"}),(0,t.jsxs)("div",{className:"font-bebas text-3xl mt-2",children:["$",k.avgOrderValue]})]})]}),(0,t.jsx)("div",{className:"px-6 py-6 border-b border-white/[0.08]",children:(0,t.jsx)("input",{type:"text",placeholder:"Search customers by email...",value:v,onChange:e=>N(e.target.value),className:"input-premium max-w-sm"})}),(0,t.jsxs)("div",{className:"px-6 py-6",children:[m?(0,t.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border border-white/20 border-t-white"})}):0===n.length?(0,t.jsx)("div",{className:"text-center py-12 text-white/60",children:"No customers found"}):(0,t.jsx)("div",{className:"overflow-x-auto rounded-2xl border border-white/[0.08]",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-white/[0.03] border-b border-white/[0.08]",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Email"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Orders"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Total Spent"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Avg Order"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Last Order"}),(0,t.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Action"})]})}),(0,t.jsx)("tbody",{children:n.map(e=>(0,t.jsxs)("tr",{className:"border-b border-white/[0.08] hover:bg-white/[0.02]",children:[(0,t.jsx)("td",{className:"px-6 py-4 text-sm",children:e.email}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm",children:e.orderCount}),(0,t.jsxs)("td",{className:"px-6 py-4 text-sm font-semibold",children:["$",e.totalSpent.toFixed(2)]}),(0,t.jsxs)("td",{className:"px-6 py-4 text-sm",children:["$",e.avgOrderValue.toFixed(2)]}),(0,t.jsxs)("td",{className:"px-6 py-4",children:[e.isVIP&&(0,t.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs bg-purple-500/20 text-purple-300 border border-purple-500/50",children:"VIP"}),e.lastOrderDaysAgo&&e.lastOrderDaysAgo<=30&&(0,t.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs bg-emerald-500/20 text-emerald-300 border border-emerald-500/50 ml-2",children:"Active"})]}),(0,t.jsxs)("td",{className:"px-6 py-4 text-sm text-white/60",children:[e.lastOrderDate?new Date(e.lastOrderDate).toLocaleDateString():"N/A",e.lastOrderDaysAgo&&(0,t.jsxs)("div",{className:"text-xs text-white/40",children:[e.lastOrderDaysAgo," days ago"]})]}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,t.jsx)("button",{onClick:()=>{var t;y(t=e.email),_(t)},className:"text-blue-400 hover:text-blue-300",children:"View 360°"})})]},e.email))})]})}),!m&&(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,t.jsxs)("p",{className:"text-white/40 text-xs",children:["Showing ",c.length," orders across ",e.length," customers",p&&" (more available)"]}),p&&(0,t.jsx)("button",{onClick:D,disabled:u,className:"text-xs tracking-[0.2em] uppercase text-white/50 hover:text-white border border-white/20 px-4 py-2 rounded transition-colors disabled:opacity-50",children:u?"Loading...":"Load More Orders"})]})]}),V&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,t.jsxs)("div",{className:"modal-panel max-w-3xl w-full max-h-96 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-bebas text-2xl",children:"Customer 360°"}),(0,t.jsx)("p",{className:"text-white/60 text-sm mt-1",children:V.email})]}),(0,t.jsx)("button",{onClick:()=>y(null),className:"text-white/60 hover:text-white",children:"✕"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-white/60 text-xs",children:"Orders"}),(0,t.jsx)("div",{className:"font-bebas text-2xl",children:V.orderCount})]}),(0,t.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-white/60 text-xs",children:"Total Spent"}),(0,t.jsxs)("div",{className:"font-bebas text-2xl",children:["$",V.totalSpent.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-white/60 text-xs",children:"Avg Order"}),(0,t.jsxs)("div",{className:"font-bebas text-2xl",children:["$",V.avgOrderValue.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-white/60 text-xs",children:"Status"}),(0,t.jsx)("div",{className:"font-bebas text-sm mt-1",children:V.isVIP?(0,t.jsx)("span",{className:"text-purple-300",children:"VIP"}):(0,t.jsx)("span",{className:"text-white/60",children:"Regular"})})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"text-white/60 text-sm block mb-2",children:"CRM Notes"}),(0,t.jsx)("textarea",{value:S,onChange:e=>O(e.target.value),placeholder:"Add internal notes about this customer...",className:"input-premium min-h-24 resize-none"}),(0,t.jsx)("button",{onClick:T,disabled:C,className:"btn-premium mt-2",children:C?"Saving...":"Save Notes"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h3",{className:"font-bebas text-lg mb-3",children:"Order Timeline"}),(0,t.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:0===E.length?(0,t.jsx)("div",{className:"text-white/60 text-sm",children:"No orders"}):E.map((e,s)=>(0,t.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3 flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("div",{className:"text-white font-medium",children:["Order #",e.id.substring(0,8)]}),(0,t.jsx)("div",{className:"text-white/60 text-xs mt-1",children:new Date(e.created_at).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-white font-semibold",children:["$",e.total_amount.toFixed(2)]}),(0,t.jsx)("span",{className:`inline-block px-2 py-1 rounded-full text-xs mt-1 ${"pending"===e.status?"bg-amber-500/20 text-amber-300":"processing"===e.status?"bg-blue-500/20 text-blue-300":"shipped"===e.status?"bg-purple-500/20 text-purple-300":"delivered"===e.status?"bg-emerald-500/20 text-emerald-300":"bg-red-500/20 text-red-300"}`,children:e.status})]})]},s))})]}),(0,t.jsx)("button",{onClick:()=>y(null),className:"btn-premium w-full",children:"Close"})]})})]})}e.s(["default",()=>d])}]);