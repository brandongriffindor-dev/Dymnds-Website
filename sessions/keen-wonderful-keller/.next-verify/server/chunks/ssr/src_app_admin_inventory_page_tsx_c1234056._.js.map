{"version":3,"sources":["../../../../../../src/app/admin/inventory/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { collection, getDocs, query, orderBy, limit, startAfter, QueryDocumentSnapshot, DocumentData } from 'firebase/firestore';\nimport { db } from '@/lib/firebase';\n\ninterface InventoryLog {\n  id: string;\n  product_id: string;\n  product_name: string;\n  size: string;\n  color: string;\n  old_stock: number;\n  new_stock: number;\n  change: number;\n  reason: string;\n  user: string;\n  created_at: string;\n}\n\nconst LOGS_PAGE_SIZE = 100;\n\nexport default function InventoryPage() {\n  const [logs, setLogs] = useState<InventoryLog[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [hasMore, setHasMore] = useState(false);\n  const [lastDoc, setLastDoc] = useState<QueryDocumentSnapshot<DocumentData> | null>(null);\n\n  useEffect(() => {\n    const fetchLogs = async () => {\n      try {\n        const logsSnapshot = await getDocs(\n          query(\n            collection(db, 'inventory_logs'),\n            orderBy('created_at', 'desc'),\n            limit(LOGS_PAGE_SIZE)\n          )\n        );\n        const logsData = logsSnapshot.docs.map(\n          (doc) =>\n            ({\n              id: doc.id,\n              ...doc.data(),\n            }) as InventoryLog\n        );\n\n        setLogs(logsData);\n\n        // Set last document for pagination\n        if (logsSnapshot.docs.length > 0) {\n          setLastDoc(logsSnapshot.docs[logsSnapshot.docs.length - 1]);\n        }\n\n        // Determine if there are more results\n        setHasMore(logsSnapshot.docs.length === LOGS_PAGE_SIZE);\n\n        setLoading(false);\n      } catch (error) {\n        console.error('Error fetching inventory logs:', error);\n        setLoading(false);\n      }\n    };\n\n    fetchLogs();\n  }, []);\n\n  const getChangeColor = (change: number): string => {\n    if (change > 0) return 'text-green-400';\n    if (change < 0) return 'text-red-400';\n    return 'text-white';\n  };\n\n  const formatDate = (date: string): string => {\n    const dateObj = new Date(date);\n    return dateObj.toLocaleString();\n  };\n\n  const loadMoreLogs = async () => {\n    if (!lastDoc || loadingMore) return;\n\n    setLoadingMore(true);\n    try {\n      const logsSnapshot = await getDocs(\n        query(\n          collection(db, 'inventory_logs'),\n          orderBy('created_at', 'desc'),\n          startAfter(lastDoc),\n          limit(LOGS_PAGE_SIZE)\n        )\n      );\n\n      const logsData = logsSnapshot.docs.map(\n        (doc) =>\n          ({\n            id: doc.id,\n            ...doc.data(),\n          }) as InventoryLog\n      );\n\n      setLogs((prevLogs) => [...prevLogs, ...logsData]);\n\n      // Update last document for next pagination\n      if (logsSnapshot.docs.length > 0) {\n        setLastDoc(logsSnapshot.docs[logsSnapshot.docs.length - 1]);\n      }\n\n      // Update hasMore flag\n      setHasMore(logsSnapshot.docs.length === LOGS_PAGE_SIZE);\n    } catch (error) {\n      console.error('Error loading more logs:', error);\n    } finally {\n      setLoadingMore(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-white\">Loading inventory logs...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <h1 className=\"text-4xl font-bebas text-white mb-8\">Inventory Audit Trail</h1>\n\n        {/* Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n          <div className=\"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-6\">\n            <p className=\"text-white/[0.6] text-sm mb-2\">Total Changes</p>\n            <p className=\"text-4xl font-bebas text-white\">{logs.length}</p>\n          </div>\n          <div className=\"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-6\">\n            <p className=\"text-white/[0.6] text-sm mb-2\">Total Restocks</p>\n            <p className=\"text-4xl font-bebas text-white\">{logs.filter((log) => log.change > 0).length}</p>\n          </div>\n          <div className=\"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-6\">\n            <p className=\"text-white/[0.6] text-sm mb-2\">Total Sold/Removed</p>\n            <p className=\"text-4xl font-bebas text-white\">{logs.filter((log) => log.change < 0).length}</p>\n          </div>\n        </div>\n\n        {/* Inventory Logs Table */}\n        <div className=\"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-6\">\n          <h2 className=\"text-2xl font-bebas text-white mb-6\">Change History</h2>\n\n          {logs.length === 0 ? (\n            <p className=\"text-white/[0.6] text-center py-8\">No inventory changes yet.</p>\n          ) : (\n            <>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-white text-sm\">\n                  <thead>\n                    <tr className=\"border-b border-white/[0.08]\">\n                      <th className=\"text-left py-3 px-4 text-white/[0.6]\">Date</th>\n                      <th className=\"text-left py-3 px-4 text-white/[0.6]\">Product</th>\n                      <th className=\"text-left py-3 px-4 text-white/[0.6]\">Size</th>\n                      <th className=\"text-center py-3 px-4 text-white/[0.6]\">Old Stock</th>\n                      <th className=\"text-center py-3 px-4 text-white/[0.6]\">New Stock</th>\n                      <th className=\"text-center py-3 px-4 text-white/[0.6]\">Change</th>\n                      <th className=\"text-left py-3 px-4 text-white/[0.6]\">Reason</th>\n                      <th className=\"text-left py-3 px-4 text-white/[0.6]\">User</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {logs.map((log) => (\n                      <tr key={log.id} className=\"border-b border-white/[0.08] hover:bg-white/[0.02]\">\n                        <td className=\"py-4 px-4 text-white/[0.7]\">\n                          {formatDate(log.created_at)}\n                        </td>\n                        <td className=\"py-4 px-4\">\n                          <div>\n                            <p className=\"text-white\">{log.product_name}</p>\n                            <p className=\"text-white/[0.5] text-xs flex items-center gap-1\">\n                              {log.color && (\n                                <>\n                                  <div\n                                    className=\"w-2 h-2 rounded-full\"\n                                    style={{ backgroundColor: log.color }}\n                                  />\n                                </>\n                              )}\n                              {log.color}\n                            </p>\n                          </div>\n                        </td>\n                        <td className=\"py-4 px-4\">{log.size}</td>\n                        <td className=\"py-4 px-4 text-center\">{log.old_stock}</td>\n                        <td className=\"py-4 px-4 text-center\">{log.new_stock}</td>\n                        <td className={`py-4 px-4 text-center font-medium ${getChangeColor(log.change)}`}>\n                          {log.change > 0 ? '+' : ''}{log.change}\n                        </td>\n                        <td className=\"py-4 px-4 text-white/[0.7]\">{log.reason}</td>\n                        <td className=\"py-4 px-4 text-white/[0.6]\">{log.user}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* Pagination info and load more button */}\n              <div className=\"mt-6 flex flex-col items-center gap-4\">\n                <p className=\"text-white/[0.6] text-sm\">Showing {logs.length} logs</p>\n                {hasMore && (\n                  <button\n                    onClick={loadMoreLogs}\n                    disabled={loadingMore}\n                    className=\"px-6 py-2 bg-white/[0.08] border border-white/[0.2] rounded-lg text-white hover:bg-white/[0.12] disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                  >\n                    {loadingMore ? 'Loading...' : 'Load More'}\n                  </button>\n                )}\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}