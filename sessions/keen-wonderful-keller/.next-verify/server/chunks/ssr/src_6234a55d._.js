module.exports=[85469,a=>{"use strict";a.i(69387);var b=a.i(60574),c=a.i(79353);let d=new Set(["email","customer_email","customerEmail","phone","password","token","idToken","creditCard","ssn"]);function e(a,b,c,e){let f={level:a,message:b,timestamp:new Date().toISOString()};return c&&Object.keys(c).length>0&&(f.context=function a(b){let c={...b};for(let[b,e]of Object.entries(c))"string"==typeof e&&d.has(b)?c[b]=e.length>3?e.slice(0,3)+"***":"***":"object"!=typeof e||null===e||Array.isArray(e)||(c[b]=a(e));return c}(c)),e instanceof Error?f.error={name:e.name,message:e.message,stack:e.stack}:e&&(f.error={name:"UnknownError",message:String(e)}),f}function f(a){let b=JSON.stringify(a);"error"===a.level||"warn"===a.level?console.error(b):console.log(b)}let g={debug(a,b){},info(a,b){f(e("info",a,b))},warn(a,b,c){f(e("warn",a,b,c))},error(a,b,c){f(e("error",a,b,c))}};function h(a,d,e){(0,b.addDoc)((0,b.collection)(c.db,"admin_audit_log"),{action:a,details:d,admin_email:e||"unknown",timestamp:(0,b.serverTimestamp)(),created_at:new Date().toISOString()}).catch(b=>{g.error("Audit log write failed",{action:a},b)})}a.s(["logAdminAction",()=>h],85469)},66795,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(79353),f=a.i(85469);function g(a){let b=new Map;return a.forEach(a=>{let c=a.customer_email;b.has(c)||b.set(c,{email:c,totalSpent:0,orderCount:0,lastOrderDate:a.created_at,notes:""});let d=b.get(c);d.totalSpent+=a.total_amount,d.orderCount+=1,d.lastOrderDate||(d.lastOrderDate=a.created_at)}),Array.from(b.values()).map(a=>{let b=a.lastOrderDate?new Date(a.lastOrderDate):null,c=new Date,d=b?Math.floor((c.getTime()-b.getTime())/864e5):void 0;return{...a,isVIP:a.totalSpent>500,avgOrderValue:a.orderCount>0?a.totalSpent/a.orderCount:0,lastOrderDaysAgo:d}}).sort((a,b)=>b.totalSpent-a.totalSpent)}function h(){let[a,h]=(0,c.useState)([]),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1);(0,c.useEffect)(()=>{n(!0);let a=(0,d.query)((0,d.collection)(e.db,"orders"),(0,d.orderBy)("created_at","desc"),(0,d.limit)(200)),b=(0,d.onSnapshot)(a,a=>{let b=[];a.forEach(a=>{b.push({...a.data(),id:a.id})}),a.docs.length>0&&t(a.docs[a.docs.length-1]),r(a.docs.length>=200),l(b),h(g(b)),n(!1)});return()=>b()},[]);let C=async()=>{if(s&&!o&&q){p(!0);try{let a=(0,d.query)((0,d.collection)(e.db,"orders"),(0,d.orderBy)("created_at","desc"),(0,d.startAfter)(s),(0,d.limit)(200)),b=await (0,d.getDocs)(a),c=[];b.forEach(a=>{c.push({...a.data(),id:a.id})}),b.docs.length>0&&t(b.docs[b.docs.length-1]),r(b.docs.length>=200);let f=[...k,...c];l(f),h(g(f))}catch(a){console.error("Error loading more orders:",a)}finally{p(!1)}}};(0,c.useEffect)(()=>{let b=a;u&&(b=b.filter(a=>a.email.toLowerCase().includes(u.toLowerCase()))),j(b)},[a,u]);let D={totalCustomers:a.length,vipCustomers:a.filter(a=>a.isVIP).length,activeThisMonth:a.filter(a=>a.lastOrderDaysAgo&&a.lastOrderDaysAgo<=30).length,avgOrderValue:a.length>0?(a.reduce((a,b)=>a+b.totalSpent,0)/a.length).toFixed(2):"0"},E=async a=>{try{let b=(await (0,d.getDocs)((0,d.collection)(e.db,"customer_notes"))).docs.find(b=>b.id===a);b?z(b.data().notes||""):z("")}catch(a){console.error("Error fetching notes:",a)}},F=async()=>{if(w){B(!0);try{let a;await (0,d.setDoc)((0,d.doc)(e.db,"customer_notes",w),{notes:y,updated_at:new Date().toISOString()},{merge:!0}),(0,f.logAdminAction)("customer_note_saved",{customerEmail:w},(a=(0,e.getAuthClient)(),a?.currentUser?.email||"unknown")),B(!1)}catch(a){console.error("Error saving notes:",a),B(!1)}}},G=a.find(a=>a.email===w),H=w?k.filter(a=>a.customer_email===w):[];return(0,b.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,b.jsxs)("div",{className:"border-b border-white/[0.08] px-6 py-8",children:[(0,b.jsx)("h1",{className:"font-bebas text-4xl tracking-wider",children:"Customers"}),(0,b.jsx)("p",{className:"text-white/60 mt-2",children:"Manage and analyze customer relationships"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 px-6 py-6",children:[(0,b.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,b.jsx)("div",{className:"text-white/60 text-sm",children:"Total Customers"}),(0,b.jsx)("div",{className:"font-bebas text-3xl mt-2",children:D.totalCustomers})]}),(0,b.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,b.jsx)("div",{className:"text-purple-300 text-sm",children:"VIP Customers"}),(0,b.jsx)("div",{className:"font-bebas text-3xl mt-2",children:D.vipCustomers})]}),(0,b.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,b.jsx)("div",{className:"text-emerald-300 text-sm",children:"Active This Month"}),(0,b.jsx)("div",{className:"font-bebas text-3xl mt-2",children:D.activeThisMonth})]}),(0,b.jsxs)("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-2xl p-4",children:[(0,b.jsx)("div",{className:"text-blue-300 text-sm",children:"Avg Order Value"}),(0,b.jsxs)("div",{className:"font-bebas text-3xl mt-2",children:["$",D.avgOrderValue]})]})]}),(0,b.jsx)("div",{className:"px-6 py-6 border-b border-white/[0.08]",children:(0,b.jsx)("input",{type:"text",placeholder:"Search customers by email...",value:u,onChange:a=>v(a.target.value),className:"input-premium max-w-sm"})}),(0,b.jsxs)("div",{className:"px-6 py-6",children:[m?(0,b.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border border-white/20 border-t-white"})}):0===i.length?(0,b.jsx)("div",{className:"text-center py-12 text-white/60",children:"No customers found"}):(0,b.jsx)("div",{className:"overflow-x-auto rounded-2xl border border-white/[0.08]",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-white/[0.03] border-b border-white/[0.08]",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Email"}),(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Orders"}),(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Total Spent"}),(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Avg Order"}),(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Last Order"}),(0,b.jsx)("th",{className:"px-6 py-4 text-left text-white/60 text-sm font-medium",children:"Action"})]})}),(0,b.jsx)("tbody",{children:i.map(a=>(0,b.jsxs)("tr",{className:"border-b border-white/[0.08] hover:bg-white/[0.02]",children:[(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.email}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:a.orderCount}),(0,b.jsxs)("td",{className:"px-6 py-4 text-sm font-semibold",children:["$",a.totalSpent.toFixed(2)]}),(0,b.jsxs)("td",{className:"px-6 py-4 text-sm",children:["$",a.avgOrderValue.toFixed(2)]}),(0,b.jsxs)("td",{className:"px-6 py-4",children:[a.isVIP&&(0,b.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs bg-purple-500/20 text-purple-300 border border-purple-500/50",children:"VIP"}),a.lastOrderDaysAgo&&a.lastOrderDaysAgo<=30&&(0,b.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs bg-emerald-500/20 text-emerald-300 border border-emerald-500/50 ml-2",children:"Active"})]}),(0,b.jsxs)("td",{className:"px-6 py-4 text-sm text-white/60",children:[a.lastOrderDate?new Date(a.lastOrderDate).toLocaleDateString():"N/A",a.lastOrderDaysAgo&&(0,b.jsxs)("div",{className:"text-xs text-white/40",children:[a.lastOrderDaysAgo," days ago"]})]}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm",children:(0,b.jsx)("button",{onClick:()=>{var b;x(b=a.email),E(b)},className:"text-blue-400 hover:text-blue-300",children:"View 360°"})})]},a.email))})]})}),!m&&(0,b.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,b.jsxs)("p",{className:"text-white/40 text-xs",children:["Showing ",k.length," orders across ",a.length," customers",q&&" (more available)"]}),q&&(0,b.jsx)("button",{onClick:C,disabled:o,className:"text-xs tracking-[0.2em] uppercase text-white/50 hover:text-white border border-white/20 px-4 py-2 rounded transition-colors disabled:opacity-50",children:o?"Loading...":"Load More Orders"})]})]}),G&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,b.jsxs)("div",{className:"modal-panel max-w-3xl w-full max-h-96 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"font-bebas text-2xl",children:"Customer 360°"}),(0,b.jsx)("p",{className:"text-white/60 text-sm mt-1",children:G.email})]}),(0,b.jsx)("button",{onClick:()=>x(null),className:"text-white/60 hover:text-white",children:"✕"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[(0,b.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,b.jsx)("div",{className:"text-white/60 text-xs",children:"Orders"}),(0,b.jsx)("div",{className:"font-bebas text-2xl",children:G.orderCount})]}),(0,b.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,b.jsx)("div",{className:"text-white/60 text-xs",children:"Total Spent"}),(0,b.jsxs)("div",{className:"font-bebas text-2xl",children:["$",G.totalSpent.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,b.jsx)("div",{className:"text-white/60 text-xs",children:"Avg Order"}),(0,b.jsxs)("div",{className:"font-bebas text-2xl",children:["$",G.avgOrderValue.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3",children:[(0,b.jsx)("div",{className:"text-white/60 text-xs",children:"Status"}),(0,b.jsx)("div",{className:"font-bebas text-sm mt-1",children:G.isVIP?(0,b.jsx)("span",{className:"text-purple-300",children:"VIP"}):(0,b.jsx)("span",{className:"text-white/60",children:"Regular"})})]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"text-white/60 text-sm block mb-2",children:"CRM Notes"}),(0,b.jsx)("textarea",{value:y,onChange:a=>z(a.target.value),placeholder:"Add internal notes about this customer...",className:"input-premium min-h-24 resize-none"}),(0,b.jsx)("button",{onClick:F,disabled:A,className:"btn-premium mt-2",children:A?"Saving...":"Save Notes"})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h3",{className:"font-bebas text-lg mb-3",children:"Order Timeline"}),(0,b.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:0===H.length?(0,b.jsx)("div",{className:"text-white/60 text-sm",children:"No orders"}):H.map((a,c)=>(0,b.jsxs)("div",{className:"bg-white/[0.02] border border-white/[0.08] rounded-lg p-3 flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsxs)("div",{className:"text-white font-medium",children:["Order #",a.id.substring(0,8)]}),(0,b.jsx)("div",{className:"text-white/60 text-xs mt-1",children:new Date(a.created_at).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-white font-semibold",children:["$",a.total_amount.toFixed(2)]}),(0,b.jsx)("span",{className:`inline-block px-2 py-1 rounded-full text-xs mt-1 ${"pending"===a.status?"bg-amber-500/20 text-amber-300":"processing"===a.status?"bg-blue-500/20 text-blue-300":"shipped"===a.status?"bg-purple-500/20 text-purple-300":"delivered"===a.status?"bg-emerald-500/20 text-emerald-300":"bg-red-500/20 text-red-300"}`,children:a.status})]})]},c))})]}),(0,b.jsx)("button",{onClick:()=>x(null),className:"btn-premium w-full",children:"Close"})]})})]})}a.s(["default",()=>h])}];

//# sourceMappingURL=src_6234a55d._.js.map