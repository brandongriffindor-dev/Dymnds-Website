module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},2717,e=>e.a(async(t,r)=>{try{let t=await e.y("firebase-admin-a14c8a5423a75469/app");e.n(t),r()}catch(e){r(e)}},!0),27817,e=>e.a(async(t,r)=>{try{let t=await e.y("firebase-admin-a14c8a5423a75469/firestore");e.n(t),r()}catch(e){r(e)}},!0),50377,e=>{"use strict";let t=new Set(["email","customer_email","customerEmail","phone","password","token","idToken","creditCard","ssn"]);function r(e,r,o,s){let a={level:e,message:r,timestamp:new Date().toISOString()};return o&&Object.keys(o).length>0&&(a.context=function e(r){let o={...r};for(let[r,s]of Object.entries(o))"string"==typeof s&&t.has(r)?o[r]=s.length>3?s.slice(0,3)+"***":"***":"object"!=typeof s||null===s||Array.isArray(s)||(o[r]=e(s));return o}(o)),s instanceof Error?a.error={name:s.name,message:s.message,stack:s.stack}:s&&(a.error={name:"UnknownError",message:String(s)}),a}function o(e){let t=JSON.stringify(e);"error"===e.level||"warn"===e.level?console.error(t):console.log(t)}e.s(["logger",0,{debug(e,t){},info(e,t){o(r("info",e,t))},warn(e,t,s){o(r("warn",e,t,s))},error(e,t,s){o(r("error",e,t,s))}}])},43959,e=>e.a(async(t,r)=>{try{var o=e.i(2717),s=e.i(27817),a=e.i(50377),n=t([o,s]);[o,s]=n.then?(await n)():n;let c=null,l=null;function i(){if(l)return l;let e=function(){let e;if(c)return c;let t=(0,o.getApps)();if(t.length>0)return c=t[0];let r=process.env.FIREBASE_SERVICE_ACCOUNT_KEY;if(!r)throw Error("FIREBASE_SERVICE_ACCOUNT_KEY is not set. Add it in Vercel Dashboard → Settings → Environment Variables.");try{e=JSON.parse(r)}catch{throw Error("FIREBASE_SERVICE_ACCOUNT_KEY is not valid JSON. Paste the entire contents of your service account JSON file.")}return c=(0,o.initializeApp)({credential:(0,o.cert)(e)}),a.logger.info("Firebase Admin SDK initialized",{projectId:e.project_id}),c}();return l=(0,s.getFirestore)(e)}e.s(["getAdminDb",()=>i]),r()}catch(e){r(e)}},!1),60826,e=>{"use strict";var t=e.i(93458);async function r(e){let r=e.headers.get("x-csrf-token"),o=await (0,t.cookies)(),s=o.get("csrf_token")?.value;return s?r?r!==s?{valid:!1,error:"CSRF token mismatch"}:{valid:!0}:{valid:!1,error:"Missing CSRF token header"}:{valid:!1,error:"Missing CSRF cookie"}}e.s(["validateCSRF",()=>r])},84970,e=>e.a(async(t,r)=>{try{var o=e.i(43959),s=e.i(27817),a=e.i(50377),n=t([o,s]);async function i(e){let t=(0,o.getAdminDb)(),r=[];for(let o of e){let e=t.collection("products").doc(o.productId),s=await e.get();if(!s.exists){r.push({productId:o.productId,size:o.size,color:o.color,message:"Product not found"});continue}let a=s.data();if(!0===a.is_deleted||!1===a.is_active){r.push({productId:o.productId,size:o.size,color:o.color,message:"Product is no longer available"});continue}let n=0;if(o.color&&a.colors&&Array.isArray(a.colors)){let e=a.colors.find(e=>e.name===o.color);e?.stock&&(n=e.stock[o.size]??0)}else a.stock&&(n=a.stock[o.size]??0);n<o.quantity&&r.push({productId:o.productId,size:o.size,color:o.color,message:0===n?`${o.size} is out of stock`:`Only ${n} left in ${o.size} (requested ${o.quantity})`})}return{valid:0===r.length,errors:r}}async function c(e,t){let r=(0,o.getAdminDb)();try{for(let o of(await r.runTransaction(async t=>{let o=[];for(let s of e){let e=r.collection("products").doc(s.productId),a=await t.get(e);if(!a.exists)throw Error(`Product ${s.productId} not found`);let n=a.data();if(!0===n.is_deleted||!1===n.is_active)throw Error(`Product ${s.productId} is no longer available`);o.push({item:s,data:n,ref:e})}for(let{item:e,data:t}of o){let r=0;if(e.color&&t.colors&&Array.isArray(t.colors)){let o=t.colors.find(t=>t.name===e.color);r=o?.stock?.[e.size]??0}else t.stock&&"object"==typeof t.stock&&(r=t.stock[e.size]??0);if(r<e.quantity)throw Error(`Insufficient stock for product ${e.productId} size ${e.size}: need ${e.quantity}, have ${r}`)}for(let{item:e,data:r,ref:s}of o)if(e.color&&r.colors&&Array.isArray(r.colors)){let o=[...r.colors],a=o.findIndex(t=>t.name===e.color);-1!==a&&(o[a]={...o[a],stock:{...o[a].stock,[e.size]:(o[a].stock[e.size]??0)-e.quantity}});let n={XS:0,S:0,M:0,L:0,XL:0,XXL:0};for(let e of o)for(let t of Object.keys(n))n[t]+=e.stock[t]??0;t.update(s,{colors:o,stock:n,updated_at:new Date().toISOString()})}else{let o=r.stock||{};t.update(s,{stock:{...o,[e.size]:(o[e.size]??0)-e.quantity},updated_at:new Date().toISOString()})}}),e))r.collection("inventory_logs").add({product_id:o.productId,size:o.size,color:o.color||null,change:-o.quantity,reason:`Order ${t}`,user_email:"system",created_at:new Date().toISOString(),timestamp:s.FieldValue.serverTimestamp()}).catch(e=>a.logger.error("Inventory log failed",{productId:o.productId,orderId:t},e));return{success:!0}}catch(r){let e=r instanceof Error?r.message:"Stock decrement failed";return a.logger.error("Stock transaction failed",{orderId:t},r),{success:!1,error:e}}}[o,s]=n.then?(await n)():n,e.s(["decrementStockTransaction",()=>c,"validateStock",()=>i]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__5edc8691._.js.map